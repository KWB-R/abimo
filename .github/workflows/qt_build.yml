name: QT Build

on: [push]

env:
  TAG_NAME_LATEST: latest

jobs:
  macos:
    name: macOS
    runs-on: macos-latest
    env:
      ARCHIVE_NAME: abimo_latest_macos
    steps:
      - name: Checkout
        uses: actions/checkout@v3
#      - name: Install Qt
#        uses: jurplel/install-qt-action@v3
      - name: Install Qt
        run: brew install qt@5
      - name: Export variables
        run: |
#          ls -l /usr/local/opt
          ls -l /usr/local/opt/qt@5
          ls -l /usr/local/opt/qt@5/bin
          echo 'export PATH="/usr/local/opt/qt@5/bin:$PATH"' >> /Users/runner/.bash_profile
          export LDFLAGS="-L/usr/local/opt/qt@5/lib"
          export CPPFLAGS="-I/usr/local/opt/qt@5/include"
      - name: Run QMake
        run: qmake src/app/app.pro
      - name: Build
        run: make release
      - name: Create archive and list files
        run: |
          ls -l
          mv release ${{ env.ARCHIVE_NAME }}
          tar -czvf ${{ env.ARCHIVE_NAME }}.tar.gz ${{ env.ARCHIVE_NAME }}
          ls -l
#      - name: Update macOS-related asset in latest release
#        uses: softprops/action-gh-release@v1
#        with:
#          token: ${{ secrets.GITHUB_TOKEN }}
#          tag_name: ${{ env.TAG_NAME_LATEST }}
#          files: ${{ env.ARCHIVE_NAME }}.tar.gz
